{% from "components/estrellas.html" import render_estrellas %}

{% for servicio in servicios %}
<div class="col-12 col-sm-6 col-lg-4 mb-4">
    <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">

            <!-- Prestador -->
            <div class="prestador-info d-flex align-items-center gap-3 flex-wrap">

                {% if servicio.usuario.imagen %}
                    <img
                        src="{{ url_for('static', filename='uploads/' + servicio.usuario.imagen) }}"
                        class="prestador-avatar"
                    >
                {% else %}
                    <div class="prestador-avatar-placeholder">
                        {{ servicio.usuario.nombre[0] }}
                    </div>
                {% endif %}

                <div class="flex-grow-1">
                    <div class="prestador-nombre fw-bold">
                        {{ servicio.usuario.nombre }}
                    </div>
                    <div class="prestador-email small text-muted">
                        {{ servicio.usuario.email }}
                    </div>
                </div>

            </div>

            <!-- Título -->
            <h5 class="card-title mt-3 mb-1">
                {{ servicio.titulo }}
            </h5>

            <a href="{{ url_for('perfil_prestador', usuario_id=servicio.usuario_id) }}"
               class="text-decoration-none text-info small mb-2">
               Ver perfil del prestador
            </a>

            <!-- Estrellas -->
            <div class="mb-2">
                {% if servicio.usuario.promedio_estrellas() %}
                    {{ render_estrellas(servicio.usuario.promedio_estrellas()) }}
                {% else %}
                    <span class="text-muted small">Sin calificaciones</span>
                {% endif %}
            </div>

            <!-- Descripción (controlada para que no rompa) -->
            <p class="card-text small flex-grow-1">
                {{ servicio.descripcion }}
            </p>

            <!-- Categoría -->
            <div class="mt-2">
                <span class="badge bg-primary">
                    {{ servicio.categoria }}
                </span>
            </div>

            <!-- Botón -->
            {% if current_user.is_authenticated and current_user.rol == 'cliente' %}
                <a href="{{ url_for('contratar_servicio', servicio_id=servicio.id) }}"
                   class="btn btn-primary btn-sm mt-3 w-100">
                   Contratar servicio
                </a>
            {% endif %}

        </div>
    </div>
</div>

{% else %}
<div class="col-12">
    <p class="text-muted text-center">
        No hay servicios publicados aún.
    </p>
</div>
{% endfor %}